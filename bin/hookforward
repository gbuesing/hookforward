#!/usr/bin/env node

var hookforward = require('../hookforward');
var fs = require('fs');
var argv = process.argv;
var command = argv[2];
var db_url = argv[3];
var handler_url = argv[4];
var rc_filepath = process.cwd() + '/.hookforwardrc';

if (fs.existsSync(rc_filepath)) {
  var rc_raw = fs.readFileSync(rc_filepath, 'utf8');
  var rc = JSON.parse(rc_raw);

  if (!db_url) { db_url = rc.db_url };
  if (!handler_url) { handler_url = rc.handler_url };
}



if (command === 'start') {

  console.log('Starting hookforward listener...');
  hookforward(db_url, handler_url);

} else if (command === 'push') {

  console.log('Pushing design doc to ' + db_url)
  hookforward.pushDesignDoc(db_url);

} else if (command === 'test') {

  hookforward.postTestHook(db_url);

} else {

  console.log('Usage:\n');
  console.log('  hookforward push DB_URL');
  console.log('  hookforward start DB_URL HANDLER_URL');

}
